(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[380,881],{6408:function(e,t,a){Promise.resolve().then(a.bind(a,8163))},8163:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var s=a(7437),r=a(2265),l=a(6463),n=a(7138),i=a(6881),c=a(6079),o=a(6251);let m=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function d(){let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),a=e.get("id"),d=(0,i.createBrowserClient)(),[u,x]=(0,r.useState)(null),[p,h]=(0,r.useState)([]),[b,f]=(0,r.useState)(!0),[y,j]=(0,r.useState)(null),[N,g]=(0,r.useState)(!1),[v,w]=(0,r.useState)(!1),[C,k]=(0,r.useState)({name:"",email:"",phone:"",address:""}),[D,I]=(0,r.useState)({}),[S,_]=(0,r.useState)(null);(0,r.useEffect)(()=>{a?(E(),P()):f(!1)},[a]);let E=async()=>{let{data:{session:e}}=await d.auth.getSession();e||t.push("/login")},P=async()=>{if(!a){j("No customer ID provided"),f(!1);return}try{let{data:e,error:t}=await d.from("customers").select("*").eq("id",a).single();if(t)throw t;if(!e)throw Error("Customer not found");x(e),k({name:e.name||"",email:e.email||"",phone:e.phone||"",address:e.address||""});let{data:s,error:r}=await d.from("invoices").select("*, materials(*)").eq("customer_id",a).order("created_at",{ascending:!1});if(r)throw r;h(s||[])}catch(e){console.error("Error fetching customer data:",e),j(e.message||"Failed to load customer")}finally{f(!1)}},B=()=>{let e={};return C.name.trim()||(e.name="Name is required"),C.email.trim()&&!m.test(C.email.trim())&&(e.email="Invalid email format"),I(e),0===Object.keys(e).length},F=async()=>{if(B()){w(!0),j(null),_(null);try{let e={name:C.name.trim(),email:C.email.trim()||null,phone:C.phone.trim()||null,address:C.address.trim()||null},{error:t}=await d.from("customers").update(e).eq("id",a);if(t)throw t;x({...u,...e}),g(!1),_("Customer updated"),setTimeout(()=>{_(null)},3e3)}catch(e){console.error("Error updating customer:",e),j(e.message||"Failed to update customer")}finally{w(!1)}}},G=e=>new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),O=e=>{let t={draft:"bg-yapmate-slate-700 text-yapmate-slate-300",sent:"bg-blue-900 text-blue-300",paid:"bg-green-900 text-green-300",cancelled:"bg-red-900 text-red-300"},a=t[e]||t.draft;return(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs font-mono uppercase ".concat(a),children:e})};return b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}),(0,s.jsx)(c.Z,{})]}):y&&!u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-yapmate-status-red text-xl mb-4",children:y||"Customer not found"}),(0,s.jsx)(n.default,{href:"/customers",className:"text-yapmate-amber hover:text-yapmate-status-yellow font-mono text-sm uppercase",children:"← Back to Customers"})]})}),(0,s.jsx)(c.Z,{})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("main",{className:"min-h-screen bg-yapmate-black pb-24",children:[(0,s.jsxs)("div",{className:"border-b border-yapmate-slate-700 px-4 py-4 flex items-center justify-between",children:[(0,s.jsx)(n.default,{href:"/customers",className:"text-yapmate-slate-300 active:text-yapmate-amber font-mono text-xs uppercase",children:"← Back"}),(0,s.jsx)("h1",{className:"font-mono text-base font-bold text-yapmate-white uppercase",children:"Customer"}),(0,s.jsx)("div",{className:"w-16"})]}),S&&(0,s.jsxs)("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-yapmate-status-green text-yapmate-black px-6 py-3 rounded-lg font-mono text-sm font-bold shadow-lg",children:["✓ ",S]}),y&&u&&(0,s.jsx)("div",{className:"mx-4 mt-4 border-2 border-yapmate-status-red bg-yapmate-status-red/10 p-4",children:(0,s.jsx)("p",{className:"text-yapmate-status-red text-sm font-mono",children:y})}),(0,s.jsxs)("div",{className:"p-6 border-b border-yapmate-slate-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,s.jsx)("div",{className:"w-20 h-20 rounded-full bg-yapmate-amber-500 flex items-center justify-center flex-shrink-0",children:(0,s.jsx)("span",{className:"text-yapmate-black font-bold text-3xl",children:(e=>{if(!e)return"?";let t=e.trim().split(" ");return 1===t.length?t[0].charAt(0).toUpperCase():(t[0].charAt(0)+t[t.length-1].charAt(0)).toUpperCase()})(N?C.name:u.name)})}),(0,s.jsx)("div",{className:"flex-1",children:N?(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"text",value:C.name,onChange:e=>k({...C,name:e.target.value}),disabled:v,className:"w-full text-2xl font-bold bg-yapmate-black border-2 ".concat(D.name?"border-yapmate-status-red":"border-yapmate-slate-700"," text-white px-3 py-2 focus:outline-none focus:border-yapmate-amber transition-colors disabled:opacity-50 disabled:cursor-not-allowed"),placeholder:"Customer name"}),D.name&&(0,s.jsx)("p",{className:"text-yapmate-status-red text-xs mt-1 font-mono",children:D.name})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white mb-1",children:u.name}),(0,s.jsxs)("p",{className:"text-yapmate-slate-400 text-sm font-mono",children:[p.length," ",1===p.length?"invoice":"invoices"]})]})}),N?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:F,disabled:v,className:"text-yapmate-black bg-yapmate-amber font-mono text-xs uppercase px-4 py-2 active:bg-yapmate-status-yellow disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Saving...":"Save"}),(0,s.jsx)("button",{onClick:()=>{k({name:u.name||"",email:u.email||"",phone:u.phone||"",address:u.address||""}),g(!1),I({}),j(null)},disabled:v,className:"text-yapmate-slate-300 border border-yapmate-slate-700 font-mono text-xs uppercase px-4 py-2 active:bg-yapmate-slate-700 disabled:opacity-50",children:"Cancel"})]}):(0,s.jsx)("button",{onClick:()=>{g(!0),I({}),_(null),j(null)},className:"text-yapmate-amber font-mono text-xs uppercase active:text-yapmate-status-yellow px-4 py-2 border border-yapmate-amber hover:bg-yapmate-amber hover:text-yapmate-black transition-colors",children:"Edit"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-yapmate-slate-300",children:[(0,s.jsx)("span",{className:"text-xl",children:"\uD83D\uDCE7"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-xs text-yapmate-slate-400 font-mono uppercase mb-1",children:"Email"}),N?(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"email",value:C.email,onChange:e=>k({...C,email:e.target.value}),disabled:v,className:"w-full text-sm bg-yapmate-black border-2 ".concat(D.email?"border-yapmate-status-red":"border-yapmate-slate-700"," text-white px-3 py-2 focus:outline-none focus:border-yapmate-amber transition-colors disabled:opacity-50 disabled:cursor-not-allowed"),placeholder:"email@example.com"}),D.email&&(0,s.jsx)("p",{className:"text-yapmate-status-red text-xs mt-1 font-mono",children:D.email})]}):(0,s.jsx)("p",{className:"text-sm",children:u.email||(0,s.jsx)("span",{className:"text-yapmate-slate-500 italic",children:"Not set"})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-yapmate-slate-300",children:[(0,s.jsx)("span",{className:"text-xl",children:"\uD83D\uDCDE"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-xs text-yapmate-slate-400 font-mono uppercase mb-1",children:"Phone"}),N?(0,s.jsx)("input",{type:"tel",value:C.phone,onChange:e=>k({...C,phone:e.target.value}),disabled:v,className:"w-full text-sm bg-yapmate-black border-2 border-yapmate-slate-700 text-white px-3 py-2 focus:outline-none focus:border-yapmate-amber transition-colors disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"07700 900000"}):(0,s.jsx)("p",{className:"text-sm",children:u.phone||(0,s.jsx)("span",{className:"text-yapmate-slate-500 italic",children:"Not set"})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-yapmate-slate-300",children:[(0,s.jsx)("span",{className:"text-xl",children:"\uD83D\uDCCD"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-xs text-yapmate-slate-400 font-mono uppercase mb-1",children:"Address"}),N?(0,s.jsx)("textarea",{value:C.address,onChange:e=>k({...C,address:e.target.value}),disabled:v,rows:3,className:"w-full text-sm bg-yapmate-black border-2 border-yapmate-slate-700 text-white px-3 py-2 focus:outline-none focus:border-yapmate-amber transition-colors resize-none disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"Full address"}):(0,s.jsx)("p",{className:"text-sm",children:u.address||(0,s.jsx)("span",{className:"text-yapmate-slate-500 italic",children:"Not set"})})]})]})]})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-white mb-4 font-mono uppercase",children:"Invoices"}),0===p.length?(0,s.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-2xl p-6 text-center",children:(0,s.jsx)("p",{className:"text-gray-400",children:"No invoices yet"})}):(0,s.jsx)("div",{className:"space-y-3",children:p.map(e=>{var t,a,r;let l=(0,o.IG)(e.labour_hours,e.labour_rate,(null===(t=e.materials)||void 0===t?void 0:t.map(e=>({cost:e.cost,quantity:e.quantity})))||[],null!==(a=e.cis_job)&&void 0!==a&&a,e.cis_rate,null!==(r=e.vat_registered)&&void 0!==r&&r,e.vat_rate);return(0,s.jsxs)(n.default,{href:"/invoice?id=".concat(e.id),className:"bg-white/10 backdrop-blur-lg rounded-lg p-4 flex items-center justify-between hover:bg-white/15 transition-colors block",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("p",{className:"text-yapmate-slate-400 text-sm font-mono",children:G(e.created_at)}),O(e.status)]}),(0,s.jsx)("p",{className:"text-white text-base mb-1",children:e.job_summary}),e.notes&&(0,s.jsx)("p",{className:"text-yapmate-slate-400 text-sm",children:e.notes})]}),(0,s.jsxs)("div",{className:"text-right ml-4",children:[(0,s.jsx)("p",{className:"text-yapmate-amber font-bold text-lg font-mono",children:(0,o.xG)(l.invoiceTotal)}),(0,s.jsx)("p",{className:"text-yapmate-slate-400 text-xs mt-1",children:"›"})]})]},e.id)})})]})]}),(0,s.jsx)(c.Z,{})]})}function u(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("span",{className:"font-mono text-sm text-yapmate-slate-300",children:"/ / LOADING"})}),children:(0,s.jsx)(d,{})})}},6079:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(7437),r=a(7138),l=a(6463);function n(){let e=(0,l.usePathname)();return(0,s.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 bg-yapmate-black/95 backdrop-blur-lg border-t border-yapmate-slate-800 pb-safe",children:(0,s.jsx)("div",{className:"flex justify-around items-center",style:{height:"68px"},children:[{href:"/record",label:"Record",icon:"\uD83C\uDFA4"},{href:"/dashboard",label:"Invoices",icon:"\uD83D\uDCC4"},{href:"/customers",label:"Customers",icon:"\uD83D\uDC65"},{href:"/settings",label:"Settings",icon:"⚙️"}].map(t=>{let a=e===t.href;return(0,s.jsxs)(r.default,{href:t.href,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors duration-200 tap-highlight ".concat(a?"text-yapmate-amber-500":"text-yapmate-slate-400 active:text-yapmate-slate-200"),children:[(0,s.jsx)("span",{className:"text-2xl mb-1",children:t.icon}),(0,s.jsx)("span",{className:"text-xs font-semibold",children:t.label})]},t.href)})})})}},6881:function(e,t,a){"use strict";a.d(t,{O:function(){return n},createBrowserClient:function(){return c}});var s=a(7204);a(4392);let r="https://nidijdprgoauwkmuioer.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pZGlqZHByZ29hdXdrbXVpb2VyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMDc4NzcsImV4cCI6MjA4MDc4Mzg3N30.kpCiLgYxayUlUOPM0Uip1QsT5wnBpj7gv8yLKOB0vDY";if(!r||!l)throw Error("Missing Supabase environment variables");let n=(0,s.eI)(r,l),i=null;function c(){return i||(i=(0,s.eI)(r,l))}},6251:function(e,t,a){"use strict";function s(e,t,a,s,r,l,n){let i=e=>Math.round(100*e)/100,c=i(!e||e<=0?0:e*t),o=i(a.reduce((e,t)=>e+t.cost*t.quantity,0)),m=i(c+o),d=l?i(m<=0?0:m*n/100):0,u=i(m+d),x=s?i(c<=0?0:c*r/100):0,p=i(u-x);return{labourSubtotal:c,materialsSubtotal:o,subtotal:m,vatAmount:d,invoiceTotal:u,cisDeduction:x,netPayment:p,grandTotal:u}}function r(e){return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e)}a.d(t,{IG:function(){return s},xG:function(){return r}})},7138:function(e,t,a){"use strict";a.d(t,{default:function(){return r.a}});var s=a(231),r=a.n(s)},6463:function(e,t,a){"use strict";var s=a(1169);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[392,231,971,23,744],function(){return e(e.s=6408)}),_N_E=e.O()}]);
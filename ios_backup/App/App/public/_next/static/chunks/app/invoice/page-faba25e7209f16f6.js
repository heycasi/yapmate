(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[206],{8358:function(e,a,t){Promise.resolve().then(t.bind(t,9156))},9156:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return p}});var s=t(7437),l=t(2265),r=t(6463),n=t(6881),i=t(6079),c=t(6251);function o(e){let{children:a,title:t,description:l,action:r,maxWidth:n="default"}=e;return(0,s.jsx)("main",{className:"min-h-screen px-4 pt-6 pb-safe",children:(0,s.jsxs)("div",{className:"".concat({default:"max-w-4xl",wide:"max-w-6xl",full:"max-w-full"}[n]," mx-auto"),children:[(t||l||r)&&(0,s.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,s.jsxs)("div",{className:"flex-1",children:[t&&(0,s.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2",children:t}),l&&(0,s.jsx)("p",{className:"text-yapmate-slate-300",children:l})]}),r&&(0,s.jsx)("div",{className:"ml-4",children:r})]}),a]})})}function d(e){let{children:a,className:t="",elevated:l=!1,interactive:r=!1}=e;return(0,s.jsx)("div",{className:"".concat("bg-yapmate-slate-800 rounded-xl shadow-lg"," ").concat(l?"p-6 shadow-xl":"p-4"," ").concat(r?"active:bg-yapmate-slate-700 transition-colors duration-200":""," ").concat(t),children:a})}function m(e){let{variant:a="primary",size:t="default",className:l="",children:r,...n}=e;return(0,s.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-xl font-semibold transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-yapmate-amber-500 text-yapmate-black shadow-lg shadow-yapmate-amber-500/50 active:bg-yapmate-amber-600",secondary:"border-2 border-yapmate-slate-700 text-yapmate-slate-100 active:bg-yapmate-slate-800",destructive:"bg-red-500 text-white active:bg-red-600",icon:"rounded-full active:bg-yapmate-slate-800 text-yapmate-slate-100"}[a]," ").concat({default:"icon"===a?"w-11 h-11":"h-12 px-6",large:"icon"===a?"w-14 h-14":"h-14 px-8"}[t]," ").concat(l),...n,children:r})}function u(e){let{children:a,className:t=""}=e;return(0,s.jsx)("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-safe bg-yapmate-black border-t border-yapmate-slate-800 ".concat(t),children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto",children:a})})}function x(){var e,a;let t=(0,r.useSearchParams)().get("id"),x=(0,r.useRouter)(),[p,b]=(0,l.useState)(!0),[h,y]=(0,l.useState)(!1),[f,g]=(0,l.useState)(null),[j,v]=(0,l.useState)([]),[N,_]=(0,l.useState)(null);(0,l.useEffect)(()=>{t?(w(),k(t)):b(!1)},[t]);let w=async()=>{let{data:{session:e}}=await n.OQ.auth.getSession();e||x.push("/login")},k=async e=>{try{let{data:a,error:t}=await n.OQ.from("invoices").select("*, materials(*)").eq("id",e).single();if(t)throw t;if(!a)throw Error("Invoice not found");g(a),v(a.materials||[])}catch(e){console.error("Error fetching invoice:",e),_("Failed to load invoice")}finally{b(!1)}},C=async()=>{if(t&&f){y(!0),_(null);try{let{error:e}=await n.OQ.from("invoices").update({customer_name:f.customer_name,job_summary:f.job_summary,labour_hours:f.labour_hours,labour_rate:f.labour_rate,cis_job:f.cis_job,cis_rate:f.cis_rate,vat_registered:f.vat_registered,vat_rate:f.vat_rate,notes:f.notes,status:f.status}).eq("id",t);if(e)throw e;j.map(e=>({...e,invoice_id:t,id:e.id||void 0})),await n.OQ.from("materials").delete().eq("invoice_id",t);let a=j.map(e=>{let{id:a,...s}=e;return{...s,invoice_id:t}});if(a.length>0){let{error:e}=await n.OQ.from("materials").insert(a);if(e)throw e}x.push("/dashboard")}catch(e){console.error(e),_(e.message||"Failed to save invoice")}finally{y(!1)}}},I=e=>{v(j.filter((a,t)=>t!==e))},S=(e,a,t)=>{let s=[...j];s[e]={...s[e],[a]:t},v(s)},D=async()=>{alert("Payment Links require server-side functions. Disabled for Static Export.")};if(p)return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o,{title:"Loading...",children:(0,s.jsx)("div",{className:"text-yapmate-slate-400 text-center py-12",children:"Loading invoice..."})}),(0,s.jsx)(i.Z,{})]});if(!f)return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o,{title:"Not Found",children:(0,s.jsx)("div",{className:"text-yapmate-slate-400 text-center py-12",children:"Invoice not found or invalid ID."})}),(0,s.jsx)(i.Z,{})]});let F=(0,c.IG)(f.labour_hours,f.labour_rate,j.map(e=>({cost:e.cost,quantity:e.quantity})),null!==(e=f.cis_job)&&void 0!==e&&e,f.cis_rate,null!==(a=f.vat_registered)&&void 0!==a&&a,f.vat_rate);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(o,{title:"Edit Invoice",action:(0,s.jsx)("button",{onClick:()=>x.push("/dashboard"),className:"text-yapmate-slate-400 active:text-yapmate-slate-200 text-sm font-semibold",children:"← Back"}),children:[N&&(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-500 rounded-xl p-4 mb-4",children:(0,s.jsx)("p",{className:"text-red-200 text-sm",children:N})}),(!f.customer_name||null===f.labour_hours||null===f.cis_job||null===f.vat_registered||j.some(e=>null===e.cost))&&(0,s.jsxs)("div",{className:"bg-yapmate-amber-500/20 border border-yapmate-amber-500/50 rounded-xl p-4 mb-4",children:[(0,s.jsx)("p",{className:"text-yapmate-amber-400 text-sm font-semibold mb-1",children:"⚠️ AI Draft - Please Review"}),(0,s.jsx)("p",{className:"text-yapmate-amber-200 text-xs",children:"Some fields couldn't be extracted. Highlighted fields need confirmation."})]}),(0,s.jsxs)("div",{className:"space-y-4 mb-32",children:[(0,s.jsxs)(d,{children:[(0,s.jsxs)("label",{className:"block text-yapmate-slate-400 text-label mb-2",children:["Customer Name",!f.customer_name&&(0,s.jsx)("span",{className:"ml-2 text-yapmate-amber-400",children:"⚠️ Required"})]}),(0,s.jsx)("input",{type:"text",value:f.customer_name||"",onChange:e=>g({...f,customer_name:e.target.value}),className:"w-full px-4 py-3 rounded-lg bg-yapmate-slate-900 border ".concat(f.customer_name?"border-yapmate-slate-700":"border-yapmate-amber-500/70 ring-2 ring-yapmate-amber-500/30"," text-white placeholder-yapmate-slate-500 focus:outline-none focus:ring-2 focus:ring-yapmate-amber-500"),placeholder:"Customer name"})]}),(0,s.jsxs)(d,{children:[(0,s.jsx)("label",{className:"block text-yapmate-slate-400 text-label mb-2",children:"Job Summary"}),(0,s.jsx)("textarea",{value:f.job_summary,onChange:e=>g({...f,job_summary:e.target.value}),rows:3,className:"w-full px-4 py-3 rounded-lg bg-yapmate-slate-900 border border-yapmate-slate-700 text-white placeholder-yapmate-slate-500 focus:outline-none focus:ring-2 focus:ring-yapmate-amber-500"})]}),(0,s.jsxs)(d,{children:[(0,s.jsx)("h3",{className:"text-white font-semibold mb-4",children:"Labour"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-yapmate-slate-400 text-label mb-2",children:["Hours",null===f.labour_hours&&(0,s.jsx)("span",{className:"ml-2 text-yapmate-amber-400",children:"⚠️"})]}),(0,s.jsx)("input",{type:"number",step:"0.5",value:f.labour_hours||"",onChange:e=>g({...f,labour_hours:parseFloat(e.target.value)||null}),className:"w-full px-4 py-3 rounded-lg bg-yapmate-slate-900 border ".concat(null===f.labour_hours?"border-yapmate-amber-500/70 ring-2 ring-yapmate-amber-500/30":"border-yapmate-slate-700"," text-white placeholder-yapmate-slate-500 focus:outline-none focus:ring-2 focus:ring-yapmate-amber-500"),placeholder:"Hours"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-yapmate-slate-400 text-label mb-2",children:"Rate (\xa3/hr)"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:f.labour_rate,onChange:e=>g({...f,labour_rate:parseFloat(e.target.value)||0}),className:"w-full px-4 py-3 rounded-lg bg-yapmate-slate-900 border border-yapmate-slate-700 text-white placeholder-yapmate-slate-500 focus:outline-none focus:ring-2 focus:ring-yapmate-amber-500"})]})]})]}),(0,s.jsxs)(d,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-white font-semibold",children:"Materials"}),(0,s.jsx)("button",{onClick:()=>{v([...j,{description:"",cost:0,quantity:1}])},className:"text-yapmate-amber-500 active:text-yapmate-amber-600 text-sm font-semibold",children:"+ Add"})]}),(0,s.jsx)("div",{className:"space-y-2",children:j.map((e,a)=>{var t;return(0,s.jsxs)("div",{className:"flex gap-2 items-center bg-yapmate-slate-900 p-2 rounded-lg",children:[(0,s.jsx)("input",{type:"text",value:e.description,onChange:e=>S(a,"description",e.target.value),placeholder:"Description",className:"flex-1 px-3 py-2 rounded bg-yapmate-black border border-yapmate-slate-700 text-white placeholder-yapmate-slate-500 text-sm focus:outline-none focus:ring-2 focus:ring-yapmate-amber-500"}),(0,s.jsx)("input",{type:"number",value:e.quantity,onChange:e=>S(a,"quantity",parseFloat(e.target.value)||1),placeholder:"Qty",className:"w-16 px-2 py-2 rounded bg-yapmate-black border border-yapmate-slate-700 text-white text-sm focus:outline-none focus:ring-2 focus:ring-yapmate-amber-500"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:null!==(t=e.cost)&&void 0!==t?t:"",onChange:e=>S(a,"cost",""===e.target.value?null:parseFloat(e.target.value)),placeholder:"\xa3",className:"w-20 px-2 py-2 rounded border text-white text-sm focus:outline-none focus:ring-2 focus:ring-yapmate-amber-500 ".concat(null===e.cost?"bg-yapmate-amber-500/10 border-yapmate-amber-500":"bg-yapmate-black border-yapmate-slate-700")}),(0,s.jsx)("button",{onClick:()=>I(a),className:"w-8 h-8 bg-red-500/20 active:bg-red-500/30 text-red-400 rounded transition-colors",children:"\xd7"})]},a)})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)(d,{className:"p-3",children:[(0,s.jsxs)("label",{className:"block text-yapmate-slate-400 text-xs mb-2 uppercase tracking-wide",children:["CIS Job (",f.cis_rate,"%)",null===f.cis_job&&(0,s.jsx)("span",{className:"ml-1 text-yapmate-amber-400",children:"⚠️"})]}),(0,s.jsxs)("div",{className:"flex gap-2 p-1 rounded-lg ".concat(null===f.cis_job?"bg-yapmate-amber-500/10":"bg-yapmate-slate-900"),children:[(0,s.jsx)("button",{onClick:()=>g({...f,cis_job:!0}),className:"flex-1 py-2 px-3 rounded text-sm font-medium transition-colors ".concat(!0===f.cis_job?"bg-green-600 text-white":"bg-yapmate-slate-800 text-yapmate-slate-300 active:bg-yapmate-slate-700"),children:"Yes"}),(0,s.jsx)("button",{onClick:()=>g({...f,cis_job:!1}),className:"flex-1 py-2 px-3 rounded text-sm font-medium transition-colors ".concat(!1===f.cis_job?"bg-yapmate-slate-600 text-white":"bg-yapmate-slate-800 text-yapmate-slate-300 active:bg-yapmate-slate-700"),children:"No"})]})]}),(0,s.jsxs)(d,{className:"p-3",children:[(0,s.jsxs)("label",{className:"block text-yapmate-slate-400 text-xs mb-2 uppercase tracking-wide",children:["VAT Registered (",f.vat_rate,"%)",null===f.vat_registered&&(0,s.jsx)("span",{className:"ml-1 text-yapmate-amber-400",children:"⚠️"})]}),(0,s.jsxs)("div",{className:"flex gap-2 p-1 rounded-lg ".concat(null===f.vat_registered?"bg-yapmate-amber-500/10":"bg-yapmate-slate-900"),children:[(0,s.jsx)("button",{onClick:()=>g({...f,vat_registered:!0}),className:"flex-1 py-2 px-3 rounded text-sm font-medium transition-colors ".concat(!0===f.vat_registered?"bg-green-600 text-white":"bg-yapmate-slate-800 text-yapmate-slate-300 active:bg-yapmate-slate-700"),children:"Yes"}),(0,s.jsx)("button",{onClick:()=>g({...f,vat_registered:!1}),className:"flex-1 py-2 px-3 rounded text-sm font-medium transition-colors ".concat(!1===f.vat_registered?"bg-yapmate-slate-600 text-white":"bg-yapmate-slate-800 text-yapmate-slate-300 active:bg-yapmate-slate-700"),children:"No"})]})]})]}),(0,s.jsxs)(d,{children:[(0,s.jsx)("label",{className:"block text-yapmate-slate-400 text-label mb-2",children:"Notes (Optional)"}),(0,s.jsx)("textarea",{value:f.notes||"",onChange:e=>g({...f,notes:e.target.value}),rows:2,className:"w-full px-4 py-3 rounded-lg bg-yapmate-slate-900 border border-yapmate-slate-700 text-white placeholder-yapmate-slate-500 focus:outline-none focus:ring-2 focus:ring-yapmate-amber-500",placeholder:"Payment terms, additional info..."})]}),(0,s.jsxs)(d,{elevated:!0,children:[(0,s.jsx)("h3",{className:"text-white font-semibold mb-4",children:"Invoice Total"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between text-yapmate-slate-300",children:[(0,s.jsx)("span",{children:"Labour"}),(0,s.jsx)("span",{className:"currency",children:(0,c.xG)(F.labourSubtotal)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-yapmate-slate-300",children:[(0,s.jsx)("span",{children:"Materials"}),(0,s.jsx)("span",{className:"currency",children:(0,c.xG)(F.materialsSubtotal)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-white font-semibold pt-2 border-t border-yapmate-slate-700",children:[(0,s.jsx)("span",{children:"Subtotal"}),(0,s.jsx)("span",{className:"currency",children:(0,c.xG)(F.subtotal)})]}),f.cis_job&&(0,s.jsxs)("div",{className:"flex justify-between text-red-400",children:[(0,s.jsxs)("span",{children:["CIS Deduction (",f.cis_rate,"%)"]}),(0,s.jsxs)("span",{className:"currency",children:["-",(0,c.xG)(F.cisDeduction)]})]}),f.vat_registered&&(0,s.jsxs)("div",{className:"flex justify-between text-yapmate-slate-300",children:[(0,s.jsxs)("span",{children:["VAT (",f.vat_rate,"%)"]}),(0,s.jsx)("span",{className:"currency",children:(0,c.xG)(F.vatAmount)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-white text-2xl font-bold pt-3 border-t border-yapmate-slate-700",children:[(0,s.jsx)("span",{children:"TOTAL"}),(0,s.jsx)("span",{className:"currency",children:(0,c.xG)(F.grandTotal)})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-4 pt-4 border-t border-yapmate-slate-700",children:[(0,s.jsx)(m,{variant:"secondary",onClick:()=>{alert("PDF Generation requires server-side functions. Disabled for Static Export.")},className:"flex-1 opacity-50 cursor-not-allowed",title:"Not available in offline/static mode",children:"PDF"}),!f.stripe_payment_link&&(0,s.jsx)(m,{variant:"secondary",onClick:D,className:"flex-1 opacity-50 cursor-not-allowed",title:"Not available in offline/static mode",children:"Payment Link"})]}),f.stripe_payment_link&&(0,s.jsxs)("div",{className:"bg-green-500/20 border border-green-500/50 rounded-lg p-3 mt-4",children:[(0,s.jsx)("p",{className:"text-green-400 text-xs font-semibold mb-1",children:"Payment Link Generated:"}),(0,s.jsx)("a",{href:f.stripe_payment_link,target:"_blank",rel:"noopener noreferrer",className:"text-green-300 text-xs break-all underline",children:f.stripe_payment_link})]})]})]}),(0,s.jsx)(u,{children:(0,s.jsx)(m,{onClick:C,disabled:h,size:"large",className:"w-full",children:h?"Saving...":"Save & Continue"})})]})})}function p(){return(0,s.jsx)(l.Suspense,{fallback:(0,s.jsx)("div",{className:"text-center p-12 text-gray-500",children:"Loading editor..."}),children:(0,s.jsx)(x,{})})}},6079:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});var s=t(7437),l=t(7138),r=t(6463);function n(){let e=(0,r.usePathname)();return(0,s.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 bg-yapmate-black/95 backdrop-blur-lg border-t border-yapmate-slate-800 pb-safe",children:(0,s.jsx)("div",{className:"flex justify-around items-center",style:{height:"68px"},children:[{href:"/dashboard",label:"Home",icon:"\uD83C\uDFE0"},{href:"/record",label:"Record",icon:"\uD83C\uDFA4"},{href:"/customers",label:"Customers",icon:"\uD83D\uDC65"},{href:"/settings",label:"Settings",icon:"⚙️"}].map(a=>{let t=e===a.href;return(0,s.jsxs)(l.default,{href:a.href,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors duration-200 tap-highlight ".concat(t?"text-yapmate-amber-500":"text-yapmate-slate-400 active:text-yapmate-slate-200"),children:[(0,s.jsx)("span",{className:"text-2xl mb-1",children:a.icon}),(0,s.jsx)("span",{className:"text-xs font-semibold",children:a.label})]},a.href)})})})}},6881:function(e,a,t){"use strict";t.d(a,{AY:function(){return c},OQ:function(){return n}});var s=t(2562);t(4392);let l="https://nidijdprgoauwkmuioer.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pZGlqZHByZ29hdXdrbXVpb2VyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMDc4NzcsImV4cCI6MjA4MDc4Mzg3N30.kpCiLgYxayUlUOPM0Uip1QsT5wnBpj7gv8yLKOB0vDY";if(!l||!r)throw Error("Missing Supabase environment variables");let n=(0,s.eI)(l,r),i=null;function c(){return i||(i=(0,s.eI)(l,r))}},6251:function(e,a,t){"use strict";function s(e,a,t,s,l,r,n){let i=!e||e<=0?0:e*a,c=t.reduce((e,a)=>e+a.cost*a.quantity,0),o=i+c,d=s?i<=0?0:i*l/100:0,m=o-d,u=r?m<=0?0:m*n/100:0;return{labourSubtotal:i,materialsSubtotal:c,subtotal:o,cisDeduction:d,vatAmount:u,grandTotal:m+u}}function l(e){return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e)}t.d(a,{IG:function(){return s},xG:function(){return l}})}},function(e){e.O(0,[231,730,971,23,744],function(){return e(e.s=8358)}),_N_E=e.O()}]);